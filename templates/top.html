{% extends 'base.html' %}
{% block meta_title %}フレフレさん|トップ{% endblock %}

{% load static %}
{% load mathfilters %}

{% block css %}
<link href="{% static 'top/top_pc.css' %}" rel="stylesheet" media="screen and (min-width:751px)">
<link href="{% static 'top/top_sp.css' %}" rel="stylesheet" media="screen and (max-width:750px)">
<link href="{% static 'top/top_common.css' %}" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;900&display=swap" rel="stylesheet">
{% endblock %}

<!DOCTYPE html>
<html lang="ja">

<head>
  {% block head %}{% endblock %}
  {% block title %}TOP{% endblock %}
</head>

<body>
  <div>{% block header %}{% endblock header %}</div>
  {% block contents %}


  <div class="container-fluid">
    <div id="question_row" class="row">
      <div class="col-12">
        <div id="question_bg_mosaic">
          <picture>
            <source media="(min-width: 751px)" srcset="{% static 'top/pc_img/bg_question_mosaic.png' %}">
            <img src="" id="question_bg_mosaic_img">
          </picture>
        </div>
        <div class="row">
          <div class="col-12 text-center">
            <div id="question_logo">Question</div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 text-center">
            <div id="question_about_you">あなたのことを教えてください</div>
          </div>
        </div>
        <div class="row choice_title">
          <div class="col-12 text-center">
            <img src="{% static 'top/common_img/choice_title.png' %}" class="choice_title_icon">
            <span class="d-block d-sm-none choice_title_new_line">
              <br>
            </span>
            当てはまる"状況"はありますか？
          </div>
        </div>
        <div class="row choice_row">
          <!--SP用 -->
          <div class="d-block d-sm-none">
            {% for c in categories %}
              <div class="row inner_choice_row_sp">
                <div class="col-1 choice_checkbox_sp">
                  <label class="check-box">
                    <input type="checkbox" id="category_choice{{ forloop.counter }}" class="category_choice{{ forloop.counter }}" value="{{ c.id }}"><span class="text choice_text"></span>
                  </label>
                </div>
                <div class="col-10">
                  <label class="check-box" for="category_choice{{ forloop.counter }}">
                    <span class="text choice_text" >{{ c.text }}</span>
                  </label>
                </div>
                <div class="col-1"></div>
              </div>
            {% endfor %}
          </div>

          <!--PC用 -->
          <div class="d-none d-sm-block">
            <div class="row">
            {% for c in categories %}
                <div class="col-4 text-center">
                  <label class="check-box">
                    <input type="checkbox" class="category_choice{{ forloop.counter }}"><span class="text choice_text" >{{ c.text }}</span>
                  </label>
                </div>
              {% if forloop.counter|mod:3 == 0 and forloop.counter != categories|length %}
              </div> <!-- row -->
              <div class="row choice_inner_row">
              {% endif %}
            {% endfor %}
            </div> <!-- row -->
          </div>
        </div>

        <div class="row choice_title">
          <div class="col-12 text-center">
            <img src="{% static 'top/common_img/choice_title.png' %}" class="choice_title_icon">
            <span class="d-block d-sm-none choice_title_new_line">
              <br>
            </span>
            当てはまる"気持ち"はありますか？
          </div>
        </div>
        <div class="row choice_row">
          <!--SP用 -->
          <div class="d-block d-sm-none">
            {% for f in feelings %}
              <div class="row inner_choice_row_sp">
                <div class="col-1 choice_checkbox_sp">
                  <label class="check-box">
                    <input type="checkbox" id="feeling_choice{{ forloop.counter }}" class="feeling_choice{{ forloop.counter }}" value="{{ f.id }}"><span class="text choice_text"></span>
                  </label>
                </div>
                <div class="col-10">
                  <label class="check-box" for="feeling_choice{{ forloop.counter }}">
                    <span class="text choice_text" >{{ f.text }}</span>
                  </label>
                </div>
                <div class="col-1"></div>
              </div>
            {% endfor %}
          </div>

          <!--PC用 -->
          <div class="d-none d-sm-block">
            <div class="row">
            {% for f in feelings %}
                <div class="col-4 text-center">
                  <label class="check-box">
                    <input type="checkbox" class="feeling_choice{{ forloop.counter }}"><span class="text choice_text" >{{ f.text }}</span>
                  </label>
                </div>
              {% if forloop.counter|mod:3 == 0 and forloop.counter != feelings|length %}
              </div> <!-- row -->
              <div class="row choice_inner_row">
              {% endif %}
            {% endfor %}
            </div> <!-- row -->
          </div>
        </div>   
      </div>
    </div>
    <div id="answer_row" class="row">
      <div class="col-12">
        a<br>
        a<br>
        a<br>
        a<br>
        a<br>
      </div>
    </div>
  </div>


  {% block footer %}
  {% endblock %}

  {% endblock contents %}

</body>

</html>

{% block js %}
<script
src="https://code.jquery.com/jquery-3.6.1.slim.js"
integrity="sha256-tXm+sa1uzsbFnbXt8GJqsgi2Tw+m4BLGDof6eUPjbtk="
crossorigin="anonymous">
</script>
<script>

function get_category_choice_class_name(elem) {
  const class_list = elem.attr('class').split(" ");
  let res = null;

  class_list.forEach(function(elem, index) {
    if(elem.match(/category_choice/)) {
      res = elem;
      return;
    }
  });

  return res;
}

function get_feeling_choice_class_name(elem) {
  const class_list = elem.attr('class').split(" ");
  let res = null;

  class_list.forEach(function(elem, index) {
    if(elem.match(/feeling_choice/)) {
      res = elem;
      return;
    }
  });

  return res;
}

$(document).ready( function(){
  $("[class^='category_choice']").on("click", function() {
    const clicked_category_class_name = get_category_choice_class_name($(this));
    $("[class^='category_choice']").each(function() {
      const category_class_name = get_category_choice_class_name($(this));
      if(clicked_category_class_name == category_class_name) {
        $(this).prop('checked', true);
      }
      else {
        $(this).prop('checked', false);
      }
    });
  });

  $("[class^='feeling_choice']").on("click", function() {
    const clicked_category_class_name = get_feeling_choice_class_name($(this));
    $("[class^='feeling_choice']").each(function() {
      const category_class_name = get_feeling_choice_class_name($(this));
      if(clicked_category_class_name == category_class_name) {
        $(this).prop('checked', true);
      }
      else {
        $(this).prop('checked', false);
      }
    });
  });
});
</script>
{% endblock %}